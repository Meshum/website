---
// Current path detection for active page highlighting
const currentPath = Astro.url.pathname;

// Helper function to determine if a path is active
const isActive = (path: string) => {
	return currentPath === path;
};
---

<nav class="fixed top-0 left-0 right-0 z-40 border-b border-border bg-surface/90 backdrop-blur-md">
	<div class="max-w-7xl mx-auto px-6">
		<div class="flex items-center justify-between h-16">
			<!-- Logo (left) -->
			<a href="/" class="logo-link flex items-center gap-3 hover:scale-105 transition-transform">
				<svg class="logo-icon" width="32" height="26" viewBox="0 0 78 63" xmlns="http://www.w3.org/2000/svg" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
					<path d="M58.794,9.209c0,-5.035 4.083,-9.117 9.117,-9.117c5.035,-0 9.117,4.082 9.117,9.117c0,5.034 -4.08,9.119 -9.117,9.119c-5.036,-0 -9.117,-4.083 -9.117,-9.119Zm9.117,32.105c3.419,-0 6.446,1.528 8.316,3.879l0,-28.259c-2.091,2.191 -5.081,3.564 -8.402,3.564c-3.321,0 -6.059,-1.258 -8.133,-3.29l-11.334,9.153c0.9,1.568 1.413,3.37 1.413,5.288c-0,1.251 -0.22,2.45 -0.619,3.57l10.748,-9.202l0.034,18.558l-0.035,0.256c1.885,-2.144 4.772,-3.517 8.012,-3.517Zm-20.835,-16.74l11.205,-9.049c-1.2,-1.755 -1.901,-3.857 -1.901,-6.122c0.001,-0.363 0.019,-0.723 0.055,-1.078l-0.981,0.788l-14.55,11.859c2.452,0.525 4.601,1.818 6.172,3.602Zm-37.947,-6.246c5.034,-0 9.117,-4.083 9.117,-9.119c-0,-5.037 -4.083,-9.117 -9.117,-9.117c-5.035,-0 -9.117,4.082 -9.117,9.117c-0,5.034 4.08,9.119 9.117,9.119Zm0.045,2.17c-3.316,0 -6.298,-1.366 -8.376,-3.544l0,28.255c1.871,-2.36 4.904,-3.895 8.331,-3.895c3.182,-0 6.026,1.324 7.913,3.403l0.005,-0.003l0.11,-18.441l10.573,8.931c-0.396,-1.114 -0.614,-2.309 -0.614,-3.555c0,-5.164 3.706,-9.489 8.691,-10.638l-15.263,-12.711l-0.093,0.003c0.052,0.42 0.081,0.845 0.081,1.275c-0,6.032 -5.085,10.92 -11.358,10.92Zm58.737,23.454c-2.653,0 -5.041,1.134 -6.706,2.945l-14.71,-10.726c0.013,-0.031 0.025,-0.061 0.034,-0.092c0.002,-0.005 0.004,-0.009 0.004,-0.012c0.637,-1.244 0.999,-2.654 0.999,-4.148c-0,-5.036 -4.081,-9.118 -9.117,-9.118c-5.618,-0 -8.962,5.194 -9.117,9.118c-0.079,2.002 0.677,3.523 0.948,4.054c0.027,0.068 0.058,0.139 0.09,0.209l-14.504,10.71c-1.665,-1.807 -4.052,-2.94 -6.703,-2.94c-5.037,0 -9.117,4.083 -9.117,9.117c-0,5.035 4.08,9.119 9.117,9.119c5.036,0 9.117,-4.082 9.117,-9.119c-0,-1.596 -0.411,-3.096 -1.132,-4.401l14.43,-10.656c2.432,2.978 6.977,6.308 6.977,6.308c-0,-0 4.441,-3.636 6.741,-6.338l14.661,10.692c-0.718,1.303 -1.129,2.802 -1.129,4.395c0,5.037 4.083,9.119 9.117,9.119c5.035,0 9.117,-4.082 9.117,-9.119c0,-5.036 -4.08,-9.117 -9.117,-9.117Z" fill="url(#meshum-logo-gradient)" fill-rule="nonzero"/>
					<defs>
						<linearGradient id="meshum-logo-gradient" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(64.215,-64.2168,64.2168,64.215,6.4125,63.2484)">
							<stop offset="0" class="gradient-start" stop-opacity="1"/>
							<stop offset="1" class="gradient-end" stop-opacity="1"/>
						</linearGradient>
					</defs>
				</svg>
				<span class="logo-text font-heading text-xl font-bold">Meshum</span>
			</a>

			<!-- Desktop links (center) -->
			<div class="hidden md:flex items-center gap-8">
				<a href="/" class={`nav-link ${isActive('/') ? 'active' : ''}`}>
					Home
				</a>
				<a href="/features" class={`nav-link ${isActive('/features') ? 'active' : ''}`}>
					Features
				</a>
				<a href="/about" class={`nav-link ${isActive('/about') ? 'active' : ''}`}>
					About
				</a>
			</div>

			<!-- Spacer for theme switcher (right) - prevents overlap -->
			<div class="w-[100px] md:w-[420px]"></div>

			<!-- Hamburger button (mobile only) -->
			<button
				class="md:hidden p-2 rounded-lg transition-colors hamburger"
				aria-label="Toggle navigation menu"
				aria-expanded="false"
				aria-controls="mobile-menu"
			>
				<svg class="w-6 h-6 hamburger-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path class="line-1" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"/>
					<path class="line-2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"/>
					<path class="line-3" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"/>
				</svg>
			</button>
		</div>
	</div>

	<!-- Mobile menu (slide-down overlay) -->
	<div id="mobile-menu" class="mobile-menu" aria-hidden="true" role="navigation">
		<div class="flex flex-col p-6 gap-2">
			<a href="/" class="mobile-link">Home</a>
			<a href="/features" class="mobile-link">Features</a>
			<a href="/about" class="mobile-link">About</a>
		</div>
	</div>
</nav>

<style>
	/* Desktop nav link styles */
	.nav-link {
		font-family: var(--font-body);
		font-size: 0.875rem;
		font-weight: 500;
		transition-property: color;
		transition-duration: 200ms;
		position: relative;
		color: var(--color-muted);
	}

	.nav-link:hover {
		color: var(--color-primary);
		text-shadow: 0 0 15px color-mix(in srgb, var(--color-primary) 20%, transparent);
	}

	/* Animated underline on hover and active states */
	.nav-link::after {
		content: '';
		position: absolute;
		bottom: -4px;
		left: 0;
		right: 0;
		height: 2px;
		background: var(--color-primary);
		border-radius: 2px;
		transform: scaleX(0);
		transition: transform 0.2s ease;
	}

	.nav-link:hover::after,
	.nav-link.active::after {
		transform: scaleX(1);
	}

	/* Active page styling */
	.nav-link.active {
		font-weight: 600;
		color: var(--color-primary);
		text-shadow: 0 0 12px color-mix(in srgb, var(--color-primary) 18%, transparent);
	}

	/* Focus states for accessibility */
	.nav-link:focus {
		outline: none;
		box-shadow: 0 0 0 2px var(--color-primary), 0 0 0 4px transparent;
		border-radius: 4px;
	}

	/* Mobile menu container */
	.mobile-menu {
		display: none;
		position: absolute;
		top: 100%;
		left: 0;
		right: 0;
		background: color-mix(in srgb, var(--color-surface) 95%, transparent);
		backdrop-filter: blur(16px);
		border-bottom: 1px solid var(--color-border);
		box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
	}

	.mobile-menu.open {
		display: block;
		animation: slideDown 0.3s ease-out;
	}

	/* Mobile link styles */
	.mobile-link {
		font-family: var(--font-body);
		font-size: 1.125rem;
		padding: 0.75rem 1rem;
		border-radius: 0.75rem;
		transition-property: background-color;
		transition-duration: 200ms;
		color: var(--color-foreground);
	}

	.mobile-link:hover {
		background: var(--color-elevated);
	}

	/* Hamburger icon animation to X */
	.hamburger-icon.open .line-1 {
		transform: rotate(45deg) translate(5px, 5px);
	}

	.hamburger-icon.open .line-2 {
		opacity: 0;
	}

	.hamburger-icon.open .line-3 {
		transform: rotate(-45deg) translate(7px, -6px);
	}

	.hamburger-icon path {
		transition: all 0.3s ease;
	}

	/* Slide down animation for mobile menu */
	@keyframes slideDown {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Logo styles */
	.logo-link {
		color: var(--color-foreground);
	}

	.logo-text {
		color: var(--color-foreground);
		text-shadow: 0 0 20px color-mix(in srgb, var(--color-primary) 15%, transparent);
		transition: text-shadow 0.3s ease;
	}

	.logo-link:hover .logo-text {
		text-shadow: 0 0 25px color-mix(in srgb, var(--color-primary) 30%, transparent);
	}

	/* Dynamic logo gradient colors based on theme */
	.logo-icon {
		filter: drop-shadow(0 0 8px color-mix(in srgb, var(--color-primary) 12%, transparent));
		transition: filter 0.3s ease;
	}

	.logo-link:hover .logo-icon {
		filter: drop-shadow(0 0 12px color-mix(in srgb, var(--color-primary) 25%, transparent));
	}

	.logo-icon .gradient-start {
		stop-color: var(--color-primary);
	}

	.logo-icon .gradient-end {
		stop-color: var(--color-accent);
	}

	/* Hamburger button styles */
	.hamburger {
		color: var(--color-foreground);
	}

	.hamburger:hover {
		background: var(--color-surface);
	}

	/* Smooth font rendering */
	* {
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
	}
</style>

<script>
	// Mobile menu toggle functionality
	const hamburger = document.querySelector('.hamburger');
	const hamburgerIcon = document.querySelector('.hamburger-icon');
	const mobileMenu = document.getElementById('mobile-menu');

	if (hamburger && mobileMenu) {
		// Toggle menu on hamburger click
		hamburger.addEventListener('click', () => {
			const isOpen = mobileMenu.classList.contains('open');

			if (isOpen) {
				// Close menu
				mobileMenu.classList.remove('open');
				hamburgerIcon?.classList.remove('open');
				mobileMenu.setAttribute('aria-hidden', 'true');
				hamburger.setAttribute('aria-expanded', 'false');
			} else {
				// Open menu
				mobileMenu.classList.add('open');
				hamburgerIcon?.classList.add('open');
				mobileMenu.setAttribute('aria-hidden', 'false');
				hamburger.setAttribute('aria-expanded', 'true');
			}
		});

		// Close menu when clicking a link
		const mobileLinks = mobileMenu.querySelectorAll('a');
		mobileLinks.forEach(link => {
			link.addEventListener('click', () => {
				mobileMenu.classList.remove('open');
				hamburgerIcon?.classList.remove('open');
				mobileMenu.setAttribute('aria-hidden', 'true');
				hamburger.setAttribute('aria-expanded', 'false');
			});
		});

		// Close menu when clicking outside
		document.addEventListener('click', (e) => {
			if (!hamburger?.contains(e.target as Node) && !mobileMenu?.contains(e.target as Node)) {
				mobileMenu.classList.remove('open');
				hamburgerIcon?.classList.remove('open');
				mobileMenu.setAttribute('aria-hidden', 'true');
				hamburger.setAttribute('aria-expanded', 'false');
			}
		});
	}
</script>
